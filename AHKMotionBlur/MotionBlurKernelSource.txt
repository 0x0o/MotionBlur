kernel vec4 motionBlur (sampler image, vec2 velocity) {
    const int NUM_SAMPLES = 3;
    
    vec4 s = vec4(0.0);
    vec2 dc = destCoord(), offset = -velocity;
    
    for (int i=0; i < (NUM_SAMPLES * 2 + 1); i++) {
        s += sample (image, samplerTransform (image, dc + offset));
        offset += velocity / float(NUM_SAMPLES);
    }
    
    return s / float((NUM_SAMPLES * 2 + 1));
}